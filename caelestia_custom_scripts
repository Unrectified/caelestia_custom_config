#!/bin/bash

CONFIG="$HOME/.config/caelestia/shell.json"
DECORATION_FILE="$HOME/.config/caelestia/hypr-user.conf"

# âš ï¸ Chemin EXACTEMENT comme dans ton fichier (avec $HOME non expansÃ©)
BLACK_WHITE_TARGET='screen_shader = $HOME/.config/hypr/custom/BWshader.glsl'

case "$1" in
  black_white)
    # ðŸ” Si la ligne est commentÃ©e â†’ dÃ©commenter
    if grep -q "^[[:space:]]*#${BLACK_WHITE_TARGET}" "$DECORATION_FILE"; then
      sed -i "s|^[[:space:]]*#${BLACK_WHITE_TARGET}|    ${BLACK_WHITE_TARGET}|" "$DECORATION_FILE"
      echo "Shader activÃ© (ligne dÃ©commentÃ©e)."

    # ðŸ” Si la ligne est active â†’ commenter
    elif grep -q "^[[:space:]]*${BLACK_WHITE_TARGET}" "$DECORATION_FILE"; then
      sed -i "s|^[[:space:]]*${BLACK_WHITE_TARGET}|    #${BLACK_WHITE_TARGET}|" "$DECORATION_FILE"
      echo "Shader dÃ©sactivÃ© (ligne commentÃ©e)."

    else
      echo "âŒ Impossible de trouver la ligne du shader !"
    fi
    ;;

  transp)
  new_state=$(jq '.appearance.transparency.enabled | not' "$CONFIG")

  new_icon=$( [ "$new_state" = "true" ] && echo "invert_colors_off" || echo "invert_colors" )

  jq --arg icon "$new_icon" --argjson state "$new_state" '
    .appearance.transparency.enabled = $state
    | (.launcher.actions[] | select(.name=="Transparency") | .icon) = $icon
  ' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
  ;;


  bar)
  new_state=$(jq '.bar.persistent | not' "$CONFIG")

  new_icon=$( [ "$new_state" = "true" ] && echo "right_panel_open" || echo "left_panel_open" )

  jq --arg icon "$new_icon" --argjson state "$new_state" '
    .bar.persistent = $state
    | (.launcher.actions[] | select(.name=="Bar") | .icon) = $icon
  ' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
  ;;

  *)
    echo "Usage : $0 [transp|bar|black_white]"
    exit 1
    ;;
esac
